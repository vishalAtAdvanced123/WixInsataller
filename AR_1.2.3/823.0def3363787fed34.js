(self.webpackChunkeSolve_project=self.webpackChunkeSolve_project||[]).push([[823],{40621:(v,l,o)=>{"use strict";o.r(l),o.d(l,{LoginModule:()=>D});var r=o(32528),c=o(36362),h=o(87514),m=o(90587),f=o(62591),S=o(68264),M=o(74903),P=o(28382),I=o(89216),C=o(50635),O=o(69562),x=o(79168),y=o(42919),L=o(96893),A=o(36183),T=o(62730),w=o(81828),U=o.n(w),k=o(2518),_=o(9206),t=o(3184),b=o(53694),F=o(28784);function Y(i,g){1&i&&(t.TgZ(0,"div",2),t._uU(1," Please Wait.... "),t.qZA())}function N(i,g){if(1&i){const e=t.EpF();t.TgZ(0,"div",2),t._uU(1),t.TgZ(2,"span",3),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.returnToLoginPage())}),t.TgZ(3,"u"),t._uU(4,"Return to Login page"),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.errorMessageForLogin," ")}}const z=[{path:"",component:(()=>{class i{constructor(e,n,s,u,a,d,p,B,Z,V,X,j,H,J){this.router=e,this._fb=n,this._authService=s,this._messageService=u,this._securityService=a,this._userRoleService=d,this._profileService=p,this._notificationsService=B,this._router=Z,this.zone=V,this.sessionService=X,this.cookieService=j,this._http=H,this._advancedSSOService=J,this.defaultPassword=!1,this.forgotPasswordClicked=!1,this.showEmailMessage=!1,this.resetEmailMessage="If a matching email address is found a reset email will be sent.\n    If you do not receive the email please check your spam folder",this.passwordExpiryMessage="",this.passwordExpiredMessage="Your password has expired, please choose a new password.",this.passwordValidatorPattern="",this.passwordValidationMessage="Password must consist of at least ",this.paternValidationMessageList=new Array,this.preferencesChanged=!1,this.hashedId="",this.encodedEmail="",this.appVersion="",this.role="",this.customerName=null,this.minimumUpperCharacters=0,this.minimumSpecialCharacters=0,this.minimumNumericCharacters=0,this.isLoggedInUsingASSO=!0,this.timeoutMinutes=0,this.isSuccessfullyLoggedIn=!0,this.errorMessageForLogin="Sorry we couldn\u2019t find you in Auto Rostering. Please contact your system administrator."}ngOnInit(){if(localStorage.getItem("isLoggedInUsingASSO"))this.loginUrl=this._authService.getLoginUrl(),localStorage.removeItem("isLoggedIn"),localStorage.removeItem("loggedUserName"),localStorage.removeItem("userCredentials"),localStorage.removeItem("userImage"),localStorage.removeItem("jwt"),localStorage.removeItem("username"),localStorage.removeItem("id"),localStorage.removeItem("role"),localStorage.removeItem("profileId"),localStorage.removeItem("connectionId"),localStorage.removeItem("hasLinkedAccount"),this.message=O.yw,this.buildForms(),this._userRoleService.setGlobalAccountPermissions(void 0),localStorage.removeItem("isSsoUserAdmin"),localStorage.removeItem("isSuperAdmin"),this.getSecurity(),this.loginUsingASSO();else{let e="",n=localStorage.getItem("authDomain");this._advancedSSOService.getSsoLoginDetails().pipe((0,C.U)(s=>s)).toPromise().then(s=>{s&&(e=s.advancedSSO.organizationHint,n=s.advancedSSO.authenticationDomain,localStorage.setItem("isLoggedInUsingASSO","true"),localStorage.setItem("organizationHint",e),localStorage.setItem("authDomain",n),localStorage.setItem("authUrl",s.assoUrls.authUrl),localStorage.setItem("authBaseUrl",s.assoUrls.authBaseUrl),e=s.isOverRuleOrganizationHint?"":e,this.redirectToAdvancedPlatformLoginPage(e,n))})}}ngAfterViewInit(){this.cookieService.get("ACCESS_TOKEN"),this.emailMessageSubscription=this.resetForm.controls.username.valueChanges.subscribe(n=>{this.showEmailMessage=!(!n||!this.resetForm.controls.username.valid)})}getSecurity(){this._securityService.getSecurity(!1).subscribe(e=>{this.timeoutMinutes=e.timeoutMinutes})}loginUsingASSO(){this._authService.login(this.loginForm.value).subscribe(e=>{if(this.IsLicensed=e.isLicensed,this.isSuperAdmin=e.isSuperAdmin,this.isSuccessfullyLoggedIn=e.isSuccessfullyLoggedIn,e.isSuccessfullyLoggedIn&&!e.message){localStorage.setItem("IsLicensed",e.isLicensed),localStorage.setItem("loggedUserName",e.nameAndSurname),localStorage.setItem("jwt",e.accessToken.token);const n=localStorage.getItem("authDomain");this.cookieService.delete("AR_TOKEN","/","."+n);const s=new Date;s.setMinutes(s.getMinutes()+this.timeoutMinutes),this.cookieService.set("AR_TOKEN",e.accessToken.token,s,"/","."+n),localStorage.setItem("isSsoUserAdmin",e.isSSOUserAdmin),e.image&&localStorage.setItem("userImage",e.image),localStorage.setItem("id",this.getDecodedAccessToken(e.accessToken.token).nameid),localStorage.setItem("role",this.getDecodedAccessToken(e.accessToken.token).role),localStorage.setItem("username",e.accessToken.username),localStorage.setItem("hasLinkedAccount",e.accessToken.hasLinkedAccount),localStorage.getItem("id")&&Number(localStorage.getItem("id"))>0&&setTimeout(()=>{this._authService.onSuccesfulLogin.next(!0)},100),this._userRoleService.closeModalUponLogout(!1),this.customerName=e.customerName,localStorage.setItem("customerName",this.customerName),this.encodedEmail=e.id,this.appVersion=e.rosteringAppVersion,this.onLoggedin(e.accessToken.token,e.nameAndSurname),this._notificationsService.shouldUpdateUnreadNotifications.next(!0),localStorage.setItem("isSuperAdmin",e.isSuperAdmin)}else this.isSuccessfullyLoggedIn||(this.isSuccessfullyLoggedIn=!1,this._messageService.open(this.errorMessageForLogin))},e=>{localStorage.removeItem("isLoggedInUsingASSO"),"Customer license is expired"==e.error||"Access Denied"==e.error?this._router.navigateByUrl("/access-denied",{state:{source:"license"}}):"The Request is invalid"==e.error[0].key?(this.isSuccessfullyLoggedIn=!1,this.errorMessageForLogin=e.error[0].value,this._messageService.open(this.errorMessageForLogin)):(this.isSuccessfullyLoggedIn=!1,this._messageService.open(this.errorMessageForLogin))})}redirectToAdvancedPlatformLoginPage(e,n){const s=window.location.origin,u=window.location.pathname;let a="";var d=localStorage.getItem("authBaseUrl");this._http.get("./assets/config.json").pipe((0,C.U)(p=>p)).toPromise().then(p=>{void 0!==n&&"oneadvanced.io"!==n&&(a="&authenticationDomain="+n),window.location.href=d+p.AUTH_URL+"?redirectUri="+s+u+(e.length>0?"&organizationHint="+e:"")+a})}buildForms(){this.buildLoginForm(),this.buildResetForm()}buildLoginForm(){this.loginForm=this._fb.group({username:[null,{validators:[m.kI.required]}],oldPassword:[null,{validators:[m.kI.required]}],newPassword:[null],confirmNewPassword:[null],isSuccessfullyLoggedIn:[null],message:[null],isFirstLogin:[null],isForgottenPassword:[!1],sendSystemAccessMail:[!1]},{validators:[(0,P.HV)("newPassword","confirmNewPassword"),(0,P.kn)("oldPassword","newPassword")]})}buildResetForm(){this.resetForm=this._fb.group({username:[null],isForgottenPassword:[!0],sendSystemAccessMail:[!1]})}getDecodedAccessToken(e){try{return(0,x.Z)(e)}catch(n){return null}}onLoggedin(e,n){this.defaultPassword||(localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userCredentials",this.loginForm.controls.username.value),this._userRoleService.changeRole(this.getDecodedAccessToken(e).role),this._userRoleService.changeProfile(this.getDecodedAccessToken(e).ProfileID),this._userRoleService.changeId(this.getDecodedAccessToken(e).nameid),this._userRoleService.changeAccountCredentialsAndImage(n),this.initializePendo(),this._authService.isSessionExpireDialogOpen.next(!1),this.sessionService.startTimer(this.timeoutMinutes),this.router.navigate(["/dashboard"]))}get f(){if(this.loginForm)return this.loginForm.controls}get rf(){if(this.resetForm)return this.resetForm.controls}initializePendo(){let e=btoa(this.encodedEmail);if(this.hashedId=U()(e).toString(),this.hashedId&&""!==this.hashedId&&this.appVersion&&""!==this.appVersion){const n={visitor:{id:this.hashedId,ro_role:localStorage.getItem("role"),ro_app_version:this.appVersion},account:{id:this.customerName}};this._authService.getPendoInitialized()?pendo.updateOptions(n):(pendo.initialize(n),this._authService.setPendoInitialized())}}getCookie(e){let a,n=document.cookie.split(";"),s=n.length,u=`${e}=`;for(let d=0;d<s;d+=1)if(a=n[d].replace(/^\s+/g,""),0==a.indexOf(u))return a.substring(u.length,a.length);return""}returnToLoginPage(){this._authService.returnToLoginPage()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(f.F0),t.Y36(m.qu),t.Y36(S.e),t.Y36(T.G),t.Y36(I.I),t.Y36(y.J),t.Y36(L.H),t.Y36(A.T),t.Y36(f.F0),t.Y36(t.R0b),t.Y36(k.Z),t.Y36(b.N),t.Y36(F.eN),t.Y36(_.N))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-login"]],decls:3,vars:3,consts:[[1,"login-page"],["class","row wait-text",4,"ngIf"],[1,"row","wait-text"],[1,"cursor-pointer",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,Y,2,0,"div",1),t.YNc(2,N,5,1,"div",1),t.qZA()),2&e&&(t.Q6J("@routerTransition",void 0),t.xp6(1),t.Q6J("ngIf",n.isLoggedInUsingASSO&&n.isSuccessfullyLoggedIn),t.xp6(1),t.Q6J("ngIf",n.isLoggedInUsingASSO&&!n.isSuccessfullyLoggedIn))},dependencies:[c.O5],styles:["[_nghost-%COMP%]{display:block}.login-page[_ngcontent-%COMP%]{position:absolute;inset:0;overflow:auto;background:var(--eSolve-secondary);text-align:center;color:#fff;padding:3em;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}.login-page[_ngcontent-%COMP%]   .col-lg-4[_ngcontent-%COMP%]{padding:0}.login-page[_ngcontent-%COMP%]   .input-lg[_ngcontent-%COMP%]{height:28px;font-size:14px;line-height:1.3333333;border-radius:0}.login-page[_ngcontent-%COMP%]   .input-underline[_ngcontent-%COMP%]{width:206px;height:30px;background:0 0;box-shadow:none;color:#666679;border:1px solid #666679;border-radius:3px}.login-page[_ngcontent-%COMP%]   .rounded-btn[_ngcontent-%COMP%]{height:32px;width:206px;border-radius:3px;color:#fff;background-color:var(--eSolve-primary);font-size:18px;padding:0 25px;margin:15px 0}.login-page[_ngcontent-%COMP%]   .rounded-btn[_ngcontent-%COMP%]:hover, .login-page[_ngcontent-%COMP%]   .rounded-btn[_ngcontent-%COMP%]:focus, .login-page[_ngcontent-%COMP%]   .rounded-btn[_ngcontent-%COMP%]:active, .login-page[_ngcontent-%COMP%]   .rounded-btn[_ngcontent-%COMP%]:visited{color:#fff;outline:none}.login-page[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:300;margin-top:20px;margin-bottom:10px;font-size:36px}.login-page[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ffffffb3}.login-page[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding:8px 0}.login-page[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::-webkit-input-placeholder{color:var(--eSolve-gray-dark)!important;padding-left:7px}.login-page[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:-moz-placeholder{color:var(--eSolve-gray-dark)!important;padding-left:7px}.login-page[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::-moz-placeholder{color:var(--eSolve-gray-dark)!important;padding-left:7px}.login-page[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:-ms-input-placeholder{color:var(--eSolve-gray-dark)!important;padding-left:7px}.login-page[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]{padding:40px 0 0;text-align:-webkit-center}.login-page[_ngcontent-%COMP%]   .form-container[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center}.login-page[_ngcontent-%COMP%]   .advancedLogo[_ngcontent-%COMP%]{width:35px}.login-page[_ngcontent-%COMP%]   .login-panel[_ngcontent-%COMP%]{background-color:var(--eSolve-white);width:366px;height:434px;border-radius:8px;padding:30px}.login-page[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]{color:var(--eSolve-primary);text-decoration-line:underline;font-size:14px;line-height:19px;margin-bottom:30px;cursor:pointer}.login-page[_ngcontent-%COMP%]   .validation-error-message[_ngcontent-%COMP%]{margin-bottom:-24px}.login-message[_ngcontent-%COMP%]{font-size:11px;color:var(--eSolve-primary)}.eSolveText[_ngcontent-%COMP%]{color:#000;font-size:20px;line-height:21px;font-weight:700}.advancedText[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:13px;line-height:18px}.advancedLogoAndText[_ngcontent-%COMP%]{width:100%;text-align:start}.margin-top[_ngcontent-%COMP%]{margin-top:16px}.align-center[_ngcontent-%COMP%]{text-align:-webkit-center}.wait-text[_ngcontent-%COMP%]{font-weight:700;font-size:30px;margin-left:40px;margin-top:40px;color:#000}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"],data:{animation:[(0,M.Z9)()]}}),i})()}];let E=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[f.Bz.forChild(z),f.Bz]}),i})(),D=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[c.ez,h.aw,E,m.u5,m.UX,r.ZX]}),i})()},74903:(v,l,o)=>{"use strict";o.d(l,{Z9:()=>c});var r=o(31631);function c(){return function h(){return(0,r.X$)("routerTransition",[])}()}},81828:v=>{function l(o){for(var r=l.BASE,c=0,h=o.length;c<h;c++)r^=o.charCodeAt(c),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return r>>>0}l.BASE=2166136261,v.exports=l}}]);
//# sourceMappingURL=823.0def3363787fed34.js.map